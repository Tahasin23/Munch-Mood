<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='admin_dashboard.css') }}">
</head>
<body>
    <div class="admin-login-container">
        <div class="admin-form">
            <div class="admin-header">
                <h2>Welcome, Admin!</h2>
                <div class="admin-actions">
                    <a href="{{ url_for('add_food') }}"><button class="action-btn">Add New Food</button></a>
                    <a href="{{ url_for('logout') }}"><button class="action-btn logout-btn">Logout</button></a>
                </div>
            </div>
            <p>You have successfully logged in to the admin dashboard.</p>
            <div class="dashboard-section">
                <h3>Manage Food Items</h3>
                <table>
                    <tr>
                        <th>Name</th>
                        <th>Image</th>
                        <th>Rating</th>
                        <th>Price</th>
                        <th>Actions</th>
                    </tr>
                    {% for food in foods %}
                    <tr>
                        <td>{{ food.name }}</td>
                        <td><img src="{{ url_for('static', filename=food.image) }}" alt="{{ food.name }}" width="60"></td>
                        <td>{{ food.rating }}</td>
                        <td>Tk {{ food.price }}</td>
                        <td>
                            <a href="{{ url_for('edit_food', food_id=food.id) }}"><button class="edit-btn">Edit</button></a>
                            <form action="{{ url_for('delete_food', food_id=food.id) }}" method="POST" style="display:inline;">
                                <button type="submit" onclick="return confirm('Delete this food?')">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </table>
            </div>

            <!-- Pending Restaurant Food Requests -->
            <div class="dashboard-section">
                <h3>Pending Restaurant Food Requests</h3>
                <table>
                    <tr>
                        <th>Restaurant Name</th>
                        <th>Owner Name</th>
                        <th>Food Name</th>
                        <th>Image</th>
                        <th>Price</th>
                        <th>Category</th>
                        <th>Action</th>
                    </tr>
                    {% for req in requests %}
                    <tr>
                        <td>{{ req[1] }}</td>
                        <td>{{ req[2] }}</td>
                        <td>{{ req[3] }}</td>
                        <td>
                            {% if req[4] %}
                                <img src="{{ url_for('static', filename=req[4]) }}" alt="{{ req[3] }}" width="60">
                            {% endif %}
                        </td>
                        <td>{{ req[5] }}</td>
                        <td>{{ req[6] }}</td>
                        <td>
                            <form action="{{ url_for('approve_request', request_id=req[0]) }}" method="POST" style="display:inline;">
                                <button type="submit" class="approve-btn">Approve</button>
                            </form>
                            <form action="{{ url_for('reject_request', request_id=req[0]) }}" method="POST" style="display:inline; margin-left:8px;">
                                <button type="submit" onclick="return confirm('Are you sure you want to reject this food request?');" class="reject-btn">Reject</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </table>
            </div>

            <!-- Pending Restaurant Requests -->
            <div class="dashboard-section">
                <h3>Pending Restaurant Requests</h3>
                <table>
                    <tr>
                        <th>Restaurant Name</th>
                        <th>Image</th>
                        <th>Action</th>
                    </tr>
                    {% for rest in pending_restaurants %}
                    <tr>
                        <td>{{ rest[1] }}</td>
                        <td>
                            {% if rest[2] %}
                                <img src="{{ url_for('static', filename=rest[2]) }}" alt="{{ rest[1] }}" width="60">
                            {% endif %}
                        </td>
                        <td>
                            <form action="{{ url_for('approve_restaurant', restaurant_id=rest[0]) }}" method="POST" style="display:inline;">
                                <button type="submit">Approve</button>
                            </form>
                            <form action="{{ url_for('delete_restaurant', restaurant_id=rest[0]) }}" method="POST" style="display:inline; margin-left:8px;">
                                <button type="submit" onclick="return confirm('Are you sure you want to delete this restaurant?');" style="background:#ee1c0d;color:#fff;">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </table>
            </div>

            <!-- Reviews Section -->
            <div class="dashboard-section">
                <h3>User Reviews</h3>
                <table>
                    <tr>
                        <th>Food</th>
                        <th>User</th>
                        <th>Rating</th>
                        <th>Review</th>
                        <th>Date</th>
                    </tr>
                    {% for review in reviews %}
                    <tr>
                        {% if review|length > 5 %}
                            <!-- Using the joined query with food and customer names -->
                            <td>{{ review[1] }}</td>
                            <td>{{ review[2] }}</td>
                            <td>
                                {% if review[3] %}
                                    {% for i in range(review[3]) %}⭐{% endfor %}
                                    ({{ review[3] }})
                                {% else %}
                                    No rating
                                {% endif %}
                            </td>
                            <td style="max-width: 300px; text-align: left; white-space: normal;">{{ review[4] }}</td>
                            <td style="white-space: nowrap;">{{ review[5].strftime('%Y-%m-%d %H:%M') if review[5] else '' }}</td>
                        {% else %}
                            <!-- Using the direct query without joins -->
                            <td>Food ID: {{ review[1] }}</td>
                            <td>User ID: {{ review[2] }}</td>
                            <td>
                                {% if review[3] %}
                                    {% for i in range(review[3]) %}⭐{% endfor %}
                                    ({{ review[3] }})
                                {% else %}
                                    No rating
                                {% endif %}
                            </td>
                            <td style="max-width: 300px; text-align: left; white-space: normal;">{{ review[4] }}</td>
                            <td style="white-space: nowrap;">{{ review[5].strftime('%Y-%m-%d %H:%M') if review[5] else '' }}</td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                    {% if reviews|length == 0 %}
                    <tr>
                        <td colspan="5" style="text-align:center;">No reviews yet.</td>
                    </tr>
                    {% endif %}
                </table>
            </div>

        </div>
    </div>
</body>
</html>